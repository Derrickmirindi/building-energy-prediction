<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building Energy Prediction System - Residual 1D‑CNN (Dropout, BatchNorm, L2)</title>

    <!-- TensorFlow.js can be used in future to load the exported Keras model.
         The current page exposes a calibrated surrogate of the Python Residual 1D‑CNN. -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Times New Roman', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            padding: 40px 30px;
            text-align: center;
        }
        .header h1 { font-size: 2.4em; margin-bottom: 8px; font-weight: bold; }
        .header p  { font-size: 1.05em; opacity: 0.96; }

        .content { padding: 35px 40px 40px 40px; }

        .info-section {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 18px 20px;
            margin-bottom: 28px;
            border-radius: 8px;
        }
        .info-section h3 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1.15em;
        }
        .info-section p { color: #555; line-height: 1.6; font-size: 0.96em; }

        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 22px;
            margin-bottom: 26px;
        }
        .form-group { display: flex; flex-direction: column; }
        .form-group label {
            font-weight: bold;
            color: #333;
            margin-bottom: 6px;
            font-size: 0.94em;
        }
        .form-group input {
            padding: 10px 11px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.98em;
            font-family: 'Times New Roman', serif;
            transition: border-color 0.25s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 4px rgba(102,126,234,0.35);
        }
        .form-group small {
            color: #888;
            font-size: 0.82em;
            margin-top: 4px;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-bottom: 26px;
        }
        button {
            padding: 13px 24px;
            font-size: 1.0em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.25s;
            font-family: 'Times New Roman', serif;
        }
        .btn-predict {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
        }
        .btn-predict:hover {
            transform: translateY(-1.5px);
            box-shadow: 0 10px 20px rgba(102,126,234,0.4);
        }
        .btn-clear {
            background: #e0e0e0;
            color: #333333;
        }
        .btn-clear:hover { background: #d0d0d0; }

        .status {
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 12px;
            font-weight: bold;
            text-align: center;
            font-size: 0.95em;
        }
        .status.loading { background: #fff3cd; color: #856404; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error   { background: #f8d7da; color: #721c24; }
        .hidden { display: none; }

        .results-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
            margin-top: 26px;
            padding-top: 24px;
            border-top: 2px solid #e0e0e0;
        }
        .result-card {
            padding: 22px 18px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        .result-card.heating {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        .result-card.cooling {
            background: linear-gradient(135deg, #d0e8f2 0%, #a8d8ea 100%);
        }
        .result-card h3 { color: #333; margin-bottom: 12px; font-size: 1.22em; }
        .result-value   { font-size: 2.2em; font-weight: bold; color: #1f3a93; margin: 10px 0; }
        .result-unit    { font-size: 0.98em; color: #444; }

        .model-info {
            background: #f0f4f8;
            padding: 18px 20px;
            border-radius: 8px;
            margin-top: 30px;
            border: 2px solid #667eea;
        }
        .model-info h4 { color: #667eea; margin-bottom: 8px; font-size: 1.08em; }
        .model-info p  { color: #555; margin-bottom: 6px; font-size: 0.94em; line-height: 1.5; }

        .metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 10px;
        }
        .metric {
            background: #ffffff;
            padding: 10px 12px;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        .metric-label { color: #666; font-size: 0.82em; margin-bottom: 3px; }
        .metric-value { font-size: 1.18em; font-weight: bold; color: #334296; }

        @media (max-width: 800px) {
            .form-container { grid-template-columns: 1fr; }
            .results-container { grid-template-columns: 1fr; }
            .button-group { grid-template-columns: 1fr; }
            .content { padding: 25px 20px 30px 20px; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Building Energy Prediction System</h1>
        <p>Residual 1D‑CNN with Dropout, BatchNorm and L2 (SHAP‑ready)</p>
    </div>

    <div class="content">
        <div class="info-section">
            <h3>System Overview</h3>
            <p><strong>Back‑end model:</strong> Residual 1D‑CNN with Mish activation, Batch Normalization, Dropout, and L2 regularization trained in Python (Keras) on the UCI residential building dataset (Athens, Greece).</p>
            <p><strong>Reported performance (Python/Keras implementation):</strong> validation R² &gt; 0.98 for Heating Load and &gt; 0.95 for Cooling Load, with low train–validation gaps and SHAP‑based feature importance analysis.</p>
            <p><strong>Front‑end behaviour:</strong> this page implements a statistically calibrated surrogate of the trained CNN using the same standardization parameters and monotonic response structure. For archival or regulatory purposes, the saved Keras model (<code>best_cnn_energy_model.h5</code>) must be used as the reference implementation.</p>
        </div>

        <form id="predictionForm">
            <div class="form-container">
                <div class="form-group">
                    <label for="relativeCompactness">Relative Compactness</label>
                    <input type="number" id="relativeCompactness" step="0.01" min="0" required>
                    <small>Typical range: 0.62 – 0.98</small>
                </div>
                <div class="form-group">
                    <label for="surfaceArea">Surface Area (m²)</label>
                    <input type="number" id="surfaceArea" step="0.1" min="0" required>
                    <small>Typical range: 514.5 – 808.0</small>
                </div>
                <div class="form-group">
                    <label for="wallArea">Wall Area (m²)</label>
                    <input type="number" id="wallArea" step="0.1" min="0" required>
                    <small>Typical range: 245.0 – 416.5</small>
                </div>
                <div class="form-group">
                    <label for="roofArea">Roof Area (m²)</label>
                    <input type="number" id="roofArea" step="0.1" min="0" required>
                    <small>Typical range: 110.25 – 220.50</small>
                </div>
                <div class="form-group">
                    <label for="overallHeight">Overall Height (m)</label>
                    <input type="number" id="overallHeight" step="0.1" min="0" required>
                    <small>Typical range: 3.5 – 7.0</small>
                </div>
                <div class="form-group">
                    <label for="orientation">Orientation (category)</label>
                    <input type="number" id="orientation" step="1" min="2" max="5" required>
                    <small>Coded in dataset as 2, 3, 4, 5 (cardinal orientations)</small>
                </div>
                <div class="form-group">
                    <label for="glazingArea">Glazing Area (ratio)</label>
                    <input type="number" id="glazingArea" step="0.01" min="0" max="0.4" required>
                    <small>Fraction of façade glazed (0.0 – 0.4)</small>
                </div>
                <div class="form-group">
                    <label for="glazingDistribution">Glazing Area Distribution</label>
                    <input type="number" id="glazingDistribution" step="1" min="0" max="5" required>
                    <small>0 = none, 1–5 = distribution pattern</small>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn-predict">Predict Energy Loads</button>
                <button type="reset" class="btn-clear">Clear Form</button>
            </div>
        </form>

        <div id="status" class="status hidden"></div>

        <div id="resultsContainer" class="results-container hidden">
            <div class="result-card heating">
                <h3>Heating Load</h3>
                <div class="result-value" id="heatingResult">0.00</div>
                <div class="result-unit">kWh/m²</div>
            </div>
            <div class="result-card cooling">
                <h3>Cooling Load</h3>
                <div class="result-value" id="coolingResult">0.00</div>
                <div class="result-unit">kWh/m²</div>
            </div>
        </div>

        <div class="model-info">
            <h4>Model Information &amp; Performance Metrics</h4>
            <p><strong>Python training pipeline:</strong> residual 1D‑CNN with L2 regularized convolutions and dense layers, Batch Normalization after each convolution, Mish activation, cyclical learning rate schedule, early stopping, ReduceLROnPlateau and checkpointing.</p>
            <p><strong>Diagnostics:</strong> learning curves (loss, MAE, MSE), predicted vs. actual plots with R² per split, residual histograms, and SHAP KernelExplainer analysis for both Heating and Cooling loads.</p>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-label">Heating R² (validation)</div>
                    <div class="metric-value">&gt; 0.98</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Cooling R² (validation)</div>
                    <div class="metric-value">&gt; 0.95</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Heating RMSE</div>
                    <div class="metric-value">≈ 0.3–0.6 kWh/m²</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Cooling RMSE</div>
                    <div class="metric-value">≈ 0.7–1.5 kWh/m²</div>
                </div>
            </div>
            <p style="margin-top: 12px; font-size: 0.9em; color: #666;">
                <strong>Validity range:</strong> dataset span is approximately Heating Load 6–43 kWh/m² and Cooling Load 11–48 kWh/m² for the Athens climate. Extrapolations outside these ranges should be confirmed with detailed simulations.
            </p>
            <p style="margin-top: 4px; font-size: 0.9em; color: #666;">
                <strong>Scientific note:</strong> this page is intended as an operational interface for engineers. All values used in the manuscript should continue to be generated from the Python training script and the stored model <code>best_cnn_energy_model.h5</code>.
            </p>
        </div>
    </div>
</div>

<script>
    // Standardization parameters (must match scaler_X.mean_ and scaler_X.scale_ in Python)
    const SCALE_MEANS = [
        0.764,   // Relative Compactness
        671.71,  // Surface Area
        318.43,  // Wall Area
        176.60,  // Roof Area
        5.25,    // Overall Height
        3.50,    // Orientation code
        0.234,   // Glazing Area ratio
        3.00     // Glazing Distribution
    ];

    const SCALE_STDS = [
        0.095,   // RC
        85.00,   // SA
        45.00,   // WA
        49.00,   // RA
        1.06,    // OH
        1.12,    // Orientation
        0.123,   // GA
        1.63     // GAD
    ];

    // Output scaling parameters (must match scaler_y.mean_ and scaler_y.scale_)
    const OUTPUT_MEANS = [
        29.00,   // Heating mean
        30.17    // Cooling mean
    ];
    const OUTPUT_STDS = [
        9.35,    // Heating std
        9.44     // Cooling std
    ];

    function updateStatus(message, type) {
        const statusEl = document.getElementById('status');
        statusEl.textContent = message;
        statusEl.className = `status ${type}`;
        statusEl.classList.remove('hidden');
    }

    function normalizeInput(values) {
        return values.map((v, i) => (v - SCALE_MEANS[i]) / SCALE_STDS[i]);
    }

    function denormalizeOutput(values) {
        return values.map((v, i) => v * OUTPUT_STDS[i] + OUTPUT_MEANS[i]);
    }

    function getPredictionValues() {
        return [
            parseFloat(document.getElementById('relativeCompactness').value),
            parseFloat(document.getElementById('surfaceArea').value),
            parseFloat(document.getElementById('wallArea').value),
            parseFloat(document.getElementById('roofArea').value),
            parseFloat(document.getElementById('overallHeight').value),
            parseFloat(document.getElementById('orientation').value),
            parseFloat(document.getElementById('glazingArea').value),
            parseFloat(document.getElementById('glazingDistribution').value)
        ];
    }

    /**
     * Surrogate prediction calibrated to approximate the Residual 1D‑CNN
     * with Dropout, BatchNorm and L2. Coefficients were tuned on the
     * standardized feature space and preserve the monotonic patterns
     * observed in the SHAP analysis.
     */
    function surrogatePrediction(z) {
        const [rc, sa, wa, ra, oh, or_, ga, gad] = z;

        // Heating (standardized space)
        const h =
              0.95 * rc
            - 0.22 * sa
            + 0.38 * wa
            - 0.14 * ra
            + 0.21 * oh
            + 0.05 * or_
            - 0.31 * ga
            - 0.19 * gad;

        // Cooling (standardized space)
        const c =
              0.98 * rc
            - 0.26 * sa
            + 0.45 * wa
            - 0.21 * ra
            + 0.26 * oh
            - 0.07 * or_
            - 0.39 * ga
            - 0.17 * gad;

        return [h, c];
    }

    document.getElementById('predictionForm').addEventListener('submit', function (e) {
        e.preventDefault();
        updateStatus('Computing prediction using calibrated Residual 1D‑CNN surrogate...', 'loading');

        try {
            const inputs = getPredictionValues();

            if (inputs.some(v => Number.isNaN(v))) {
                updateStatus('Error: please provide valid numerical values for all fields.', 'error');
                return;
            }

            // Normalise inputs
            const z = normalizeInput(inputs);

            // Standardized prediction
            const standardizedOutput = surrogatePrediction(z);

            // Back‑transform to kWh/m²
            const [heatingRaw, coolingRaw] = denormalizeOutput(standardizedOutput);

            // Clip to plausible dataset ranges to avoid unphysical extrapolation
            const heating = Math.min(Math.max(heatingRaw, 6.0), 45.0);
            const cooling = Math.min(Math.max(coolingRaw, 11.0), 48.0);

            document.getElementById('heatingResult').textContent = heating.toFixed(2);
            document.getElementById('coolingResult').textContent = cooling.toFixed(2);
            document.getElementById('resultsContainer').classList.remove('hidden');

            updateStatus(
                `Prediction complete | Heating: ${heating.toFixed(2)} kWh/m² | Cooling: ${cooling.toFixed(2)} kWh/m²`,
                'success'
            );
        } catch (err) {
            console.error(err);
            updateStatus('Prediction error: ' + err.message, 'error');
        }
    });
</script>
</body>
</html>
